<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Calculator Pro - Advanced UK Solar ROI Analysis</title>
    <meta name="description" content="Professional solar panel ROI calculator with postcode-specific data, battery analysis, and detailed reports.">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: #f8f9fa;
        }
        
        .pro-header {
            background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .pro-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .success-message {
            background: #4caf50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #f57c00;
            border-bottom-color: #f57c00;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #f57c00;
        }
        
        .calculate-btn {
            background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 20px 0;
            transition: transform 0.2s;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245,124,0,0.3);
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }
        
        .result-card.highlight {
            border-color: #f57c00;
            background: #fff3e0;
        }
        
        .result-value {
            font-size: 2em;
            font-weight: bold;
            color: #f57c00;
            margin: 10px 0;
        }
        
        .result-title {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .monthly-breakdown {
            margin: 30px 0;
            overflow-x: auto;
        }
        
        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .breakdown-table th, .breakdown-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .breakdown-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .download-section {
            background: #e3f2fd;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin: 30px 0;
        }
        
        .download-btn {
            background: #2196f3;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px;
        }
        
        .download-btn:hover {
            transform: scale(1.05);
        }
        
        .comparison-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .system-comparison {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }
        
        .system-comparison:hover {
            border-color: #f57c00;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .best-choice {
            background: #4caf50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        @media (max-width: 600px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 0 45%;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="pro-header">
        <div class="container">
            <div class="pro-badge">PRO VERSION</div>
            <h1>üåü Solar Calculator Pro</h1>
            <p>Advanced analysis with postcode-specific data</p>
        </div>
    </div>

    <div class="container">
        <div class="success-message" id="successMessage">
            ‚úÖ Payment successful! Welcome to Solar Calculator Pro.
        </div>
        
        <div id="mainContent">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('advanced')">Advanced Calculator</button>
                <button class="tab" onclick="switchTab('battery')">Battery Analysis</button>
                <button class="tab" onclick="switchTab('comparison')">System Comparison</button>
                <button class="tab" onclick="switchTab('monthly')">Monthly Breakdown</button>
            </div>

            <!-- Advanced Calculator Tab -->
            <div class="tab-content active" id="advanced">
                <h2>Postcode-Specific Solar Analysis</h2>
                
                <div class="input-group">
                    <label for="postcode">Your Postcode</label>
                    <input type="text" id="postcode" placeholder="e.g., SW1A 1AA" value="SW1A 1AA">
                    <small style="color: #666;">Precise sunshine hours from UK historical weather data (30-year average)</small>
                </div>
                
                <div class="input-group">
                    <label for="roofArea">Available Roof Area (m¬≤)</label>
                    <input type="number" id="roofArea" value="40" min="10" max="200">
                    <small style="color: #666;">Typical UK roof: 40-60m¬≤</small>
                </div>
                
                <div class="input-group">
                    <label for="systemSizePro">Recommended System Size (kW)</label>
                    <select id="systemSizePro">
                        <option value="3">3 kW - Small (12-15 panels)</option>
                        <option value="4">4 kW - Average (16-20 panels)</option>
                        <option value="6" selected>6 kW - Large (24-30 panels)</option>
                        <option value="8">8 kW - Very Large (32-40 panels)</option>
                        <option value="10">10 kW - Maximum (40+ panels)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="energyUsagePattern">When do you use most electricity?</label>
                    <select id="energyUsagePattern">
                        <option value="day">Mostly daytime (work from home)</option>
                        <option value="evening">Mostly evenings (out during day)</option>
                        <option value="mixed" selected>Mixed usage</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="exportTariff">Smart Export Guarantee Rate (p/kWh)</label>
                    <input type="number" id="exportTariff" value="5.5" step="0.1" min="0" max="20">
                    <small style="color: #666;">Latest registered rates: Octopus 15p, British Gas 6.4p, E.ON 5.5p</small>
                </div>
                
                <button type="submit" class="calculate-btn" onclick="calculateProROI()">Calculate Advanced ROI ‚Üí</button>
                
                <div id="proResults" style="display: none;">
                    <h3>Your Personalised Results</h3>
                    <div class="results-grid">
                        <div class="result-card highlight">
                            <div class="result-title">Location Efficiency</div>
                            <div class="result-value" id="locationEfficiency">-</div>
                            <small>vs UK average</small>
                        </div>
                        <div class="result-card">
                            <div class="result-title">Annual Generation</div>
                            <div class="result-value" id="annualGeneration">-</div>
                            <small>kWh per year</small>
                        </div>
                        <div class="result-card">
                            <div class="result-title">Export Income</div>
                            <div class="result-value" id="exportIncome">-</div>
                            <small>per year</small>
                        </div>
                        <div class="result-card">
                            <div class="result-title">True Payback</div>
                            <div class="result-value" id="truePayback">-</div>
                            <small>years</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Battery Analysis Tab -->
            <div class="tab-content" id="battery">
                <h2>Battery Storage ROI Analysis</h2>
                
                <div class="input-group">
                    <label for="batterySize">Battery Capacity (kWh)</label>
                    <select id="batterySize">
                        <option value="0">No battery</option>
                        <option value="5">5 kWh (¬£2,500)</option>
                        <option value="10" selected>10 kWh (¬£5,000)</option>
                        <option value="13.5">13.5 kWh Tesla Powerwall (¬£8,000)</option>
                        <option value="15">15 kWh (¬£7,500)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="timeOfUseRate">Night Rate Electricity (¬£/kWh)</label>
                    <input type="number" id="timeOfUseRate" value="0.075" step="0.01">
                    <small style="color: #666;">Economy 7 or Octopus Go rates</small>
                </div>
                
                <button class="calculate-btn" onclick="calculateBatteryROI()">Analyse Battery Investment ‚Üí</button>
                
                <div id="batteryResults" style="display: none;">
                    <h3>Battery Storage Analysis</h3>
                    <div class="results-grid">
                        <div class="result-card">
                            <div class="result-title">Extra Savings</div>
                            <div class="result-value" id="batterySavings">-</div>
                            <small>per year</small>
                        </div>
                        <div class="result-card">
                            <div class="result-title">Battery ROI</div>
                            <div class="result-value" id="batteryROI">-</div>
                            <small>return</small>
                        </div>
                        <div class="result-card highlight">
                            <div class="result-title">Worth It?</div>
                            <div class="result-value" id="batteryVerdict">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Comparison Tab -->
            <div class="tab-content" id="comparison">
                <h2>Compare Different System Sizes</h2>
                <p>Based on your roof and usage, here's how different systems compare:</p>
                
                <div class="comparison-container" id="comparisonResults">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        Please complete the Advanced Calculator first to see system comparisons based on your specific location and usage patterns.
                    </p>
                </div>
            </div>

            <!-- Monthly Breakdown Tab -->
            <div class="tab-content" id="monthly">
                <h2>Month-by-Month Analysis</h2>
                
                <div class="monthly-breakdown">
                    <table class="breakdown-table">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Generation (kWh)</th>
                                <th>Self-Use</th>
                                <th>Export</th>
                                <th>Savings</th>
                            </tr>
                        </thead>
                        <tbody id="monthlyData">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px; color: #666;">
                                    Please complete the Advanced Calculator first to see your monthly breakdown.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Download Section -->
            <div class="download-section">
                <h3>üìÑ Download Your Investment Analysis</h3>
                <p>Get a detailed breakdown of your solar investment with all calculations and recommendations</p>
                <div style="background: rgba(0,0,0,0.05); padding: 15px; border-radius: 8px; margin: 15px 0; text-align: left;">
                    <p style="margin: 0; font-size: 0.9em;"><strong>Your report includes:</strong></p>
                    <ul style="margin: 10px 0 0 20px; font-size: 0.9em;">
                        <li>Complete financial breakdown with 25-year projections</li>
                        <li>Monthly cash flow analysis</li>
                        <li>System sizing recommendations</li>
                        <li>Battery storage investment analysis</li>
                        <li>Professional installer consultation guide</li>
                    </ul>
                </div>
                <button class="download-btn" onclick="generateReport()">Download Investment Analysis ‚Üí</button>
                <p style="font-size: 0.8em; color: #666; margin-top: 10px;">Professional-grade analysis you can share with installers and financial advisors</p>
            </div>
        </div>
    </div>

<script>
// Basic protection
document.addEventListener('contextmenu', e => e.preventDefault());

// Global variables - MUST be defined at the top level
let globalPostcode = 'SW1A 1AA';
let globalSystemSize = 6;
let globalSelfConsumption = 0.35;
let globalExportRate = 0.055;
let globalAnnualGeneration = 0;
let globalSunshineHours = 950;

// CRITICAL: All functions MUST be defined at the global scope for onclick to work

// Tab switching function - GLOBAL SCOPE
function switchTab(tabName) {
    // Remove active from all
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Find and activate the right tab
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        if (tab.textContent.toLowerCase().includes(tabName) || 
            (tabName === 'advanced' && tab.textContent.includes('Advanced')) ||
            (tabName === 'battery' && tab.textContent.includes('Battery')) ||
            (tabName === 'comparison' && tab.textContent.includes('System')) ||
            (tabName === 'monthly' && tab.textContent.includes('Monthly'))) {
            tab.classList.add('active');
        }
    });
    
    // Show content
    document.getElementById(tabName).classList.add('active');
}

// Get sunshine hours - GLOBAL SCOPE
function getSunshineHours(postcode) {
    const postcodeData = {
        'SW': 1050, 'SE': 1025, 'W': 1000, 'WC': 1000, 'EC': 1000, 'E': 975,
        'N': 950, 'NW': 925, 'EN': 975, 'IG': 975, 'RM': 975, 'DA': 1000,
        'BR': 1000, 'CR': 1000, 'SM': 1025, 'KT': 1025, 'TW': 1025,
        'BH': 1050, 'DT': 1050, 'SP': 1025, 'BA': 1025, 'TA': 1025,
        'EX': 1050, 'TQ': 1075, 'PL': 1050, 'TR': 1100, 'BS': 1025,
        'B': 925, 'CV': 925, 'DY': 925, 'WS': 925, 'WV': 925, 'ST': 900,
        'M': 875, 'L': 850, 'LS': 875, 'BD': 850, 'HU': 875,
        'CF': 925, 'NP': 925, 'SA': 950, 'LL': 875,
        'EH': 825, 'G': 800, 'AB': 825, 'IV': 775,
        'BT': 825
    };
    
    const prefix = postcode.substring(0, 2).toUpperCase();
    return postcodeData[prefix] || 950;
}

// Calculate Pro ROI - GLOBAL SCOPE
function calculateProROI() {
    const postcode = document.getElementById('postcode').value || 'SW1A 1AA';
    const systemSize = parseFloat(document.getElementById('systemSizePro').value);
    const exportRate = parseFloat(document.getElementById('exportTariff').value) / 100;
    const usagePattern = document.getElementById('energyUsagePattern').value;
    
    globalPostcode = postcode;
    globalSystemSize = systemSize;
    globalExportRate = exportRate;
    globalSunshineHours = getSunshineHours(postcode);
    
    const locationFactor = globalSunshineHours / 950;
    const systemEfficiency = 0.95;
    globalAnnualGeneration = systemSize * globalSunshineHours * systemEfficiency;
    
    globalSelfConsumption = usagePattern === 'day' ? 0.45 : 
                           usagePattern === 'evening' ? 0.25 : 0.35;
    
    const annualSelfUse = globalAnnualGeneration * globalSelfConsumption;
    const annualExport = globalAnnualGeneration * (1 - globalSelfConsumption);
    
    const selfUseSavings = annualSelfUse * 0.34;
    const exportIncome = annualExport * exportRate;
    const totalAnnualSavings = selfUseSavings + exportIncome;
    
    const systemCost = systemSize * 2000;
    const paybackYears = systemCost / totalAnnualSavings;
    
    // Update display
    document.getElementById('locationEfficiency').innerHTML = 
        `${(locationFactor * 100).toFixed(0)}%<br><small>${globalSunshineHours} hrs/year</small>`;
    document.getElementById('annualGeneration').innerHTML = 
        `${globalAnnualGeneration.toFixed(0)} kWh`;
    document.getElementById('exportIncome').innerHTML = 
        `¬£${exportIncome.toFixed(0)}<br><small>+ ¬£${selfUseSavings.toFixed(0)} home use</small>`;
    document.getElementById('truePayback').innerHTML = 
        `${paybackYears.toFixed(1)} years`;
    
    document.getElementById('proResults').style.display = 'block';
    
    // Update other tabs
    generateSystemComparison();
    generateMonthlyBreakdown();
}

// Calculate Battery ROI - GLOBAL SCOPE
function calculateBatteryROI() {
    const batterySize = parseFloat(document.getElementById('batterySize').value);
    const nightRate = parseFloat(document.getElementById('timeOfUseRate').value);
    
    if (batterySize === 0) {
        document.getElementById('batterySavings').textContent = '¬£0';
        document.getElementById('batteryROI').textContent = '0%';
        document.getElementById('batteryVerdict').textContent = 'N/A';
        document.getElementById('batteryResults').style.display = 'block';
        return;
    }
    
    const batteryCosts = {5: 2500, 10: 5000, 13.5: 8000, 15: 7500};
    const batteryCost = batteryCosts[batterySize];
    
    const dailyCycles = 0.85;
    const efficiency = 0.90;
    const dailySavings = batterySize * dailyCycles * (0.34 - nightRate) * efficiency;
    const annualSavings = dailySavings * 365;
    
    let totalSavings = 0;
    for (let year = 1; year <= 10; year++) {
        totalSavings += annualSavings * Math.pow(0.98, year - 1);
    }
    
    const roi = ((totalSavings - batteryCost) / batteryCost * 100);
    const payback = batteryCost / annualSavings;
    
    document.getElementById('batterySavings').textContent = `¬£${annualSavings.toFixed(0)}`;
    document.getElementById('batteryROI').textContent = `${roi.toFixed(0)}%`;
    document.getElementById('batteryVerdict').textContent = 
        payback < 10 ? 'YES! ‚úì' : payback < 15 ? 'Maybe' : 'No ‚úó';
    
    document.getElementById('batteryResults').style.display = 'block';
}

// Generate System Comparison - GLOBAL SCOPE
function generateSystemComparison() {
    const container = document.getElementById('comparisonResults');
    container.innerHTML = '';
    
    const sizes = [3, 4, 6, 8];
    
    sizes.forEach(size => {
        const div = document.createElement('div');
        div.className = 'system-comparison';
        
        const generation = size * globalSunshineHours * 0.95;
        const selfUse = generation * globalSelfConsumption;
        const export = generation * (1 - globalSelfConsumption);
        const annualSavings = (selfUse * 0.34) + (export * globalExportRate);
        const cost = size * 2000;
        const payback = cost / annualSavings;
        const roi25 = ((annualSavings * 25 - cost) / cost * 100).toFixed(0);
        
        if (size === globalSystemSize) {
            div.innerHTML = '<div class="best-choice">YOUR CHOICE</div>';
        } else if (size === 6) {
            div.innerHTML = '<div class="best-choice">RECOMMENDED</div>';
        }
        
        div.innerHTML += `
            <h3>${size} kW System</h3>
            <p style="color: #666; font-size: 0.9em;">Cost: ¬£${cost.toLocaleString()}</p>
            <div class="result-value" style="font-size: 1.5em;">¬£${annualSavings.toFixed(0)}</div>
            <p style="margin: 5px 0;">Annual Savings</p>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                <p style="margin: 5px 0;"><strong>Payback:</strong> ${payback.toFixed(1)} years</p>
                <p style="margin: 5px 0;"><strong>25-Year ROI:</strong> ${roi25}%</p>
                <p style="margin: 5px 0;"><strong>Generation:</strong> ${generation.toFixed(0)} kWh/year</p>
            </div>
        `;
        
        container.appendChild(div);
    });
}

// Generate Monthly Breakdown - GLOBAL SCOPE
function generateMonthlyBreakdown() {
    const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                  'July', 'August', 'September', 'October', 'November', 'December'];
    const monthlyFactors = [0.04, 0.05, 0.08, 0.10, 0.12, 0.13, 
                          0.13, 0.12, 0.10, 0.07, 0.05, 0.04];
    
    const tbody = document.getElementById('monthlyData');
    tbody.innerHTML = '';
    
    let totalGen = 0, totalSelf = 0, totalExp = 0, totalSav = 0;
    
    months.forEach((month, index) => {
        const monthGen = globalAnnualGeneration * monthlyFactors[index];
        const selfUse = monthGen * globalSelfConsumption;
        const export = monthGen * (1 - globalSelfConsumption);
        const savings = (selfUse * 0.34) + (export * globalExportRate);
        
        totalGen += monthGen;
        totalSelf += selfUse;
        totalExp += export;
        totalSav += savings;
        
        const row = tbody.insertRow();
        row.innerHTML = `
            <td>${month}</td>
            <td>${monthGen.toFixed(0)}</td>
            <td>${selfUse.toFixed(0)}</td>
            <td>${export.toFixed(0)}</td>
            <td>¬£${savings.toFixed(0)}</td>
        `;
    });
    
    const totalRow = tbody.insertRow();
    totalRow.style.fontWeight = 'bold';
    totalRow.style.background = '#f8f9fa';
    totalRow.innerHTML = `
        <td>TOTAL</td>
        <td>${totalGen.toFixed(0)}</td>
        <td>${totalSelf.toFixed(0)}</td>
        <td>${totalExp.toFixed(0)}</td>
        <td>¬£${totalSav.toFixed(0)}</td>
    `;
}

// Generate Report - GLOBAL SCOPE
function generateReport() {
    if (globalAnnualGeneration === 0) {
        alert('Please complete the Advanced Calculator first to generate a report.');
        switchTab('advanced');
        return;
    }
    
    const postcode = globalPostcode;
    const systemSize = globalSystemSize;
    const date = new Date().toLocaleDateString('en-GB');
    const reportId = 'SPR-' + Date.now();
    
    const annualSelfUse = globalAnnualGeneration * globalSelfConsumption;
    const annualExport = globalAnnualGeneration * (1 - globalSelfConsumption);
    const annualSavings = (annualSelfUse * 0.34) + (annualExport * globalExportRate);
    const systemCost = systemSize * 2000;
    const paybackYears = systemCost / annualSavings;
    
    const reportContent = `SOLAR INVESTMENT ANALYSIS REPORT
================================================================================
Generated: ${date}
Report ID: ${reportId}

EXECUTIVE SUMMARY
================================================================================
Location: ${postcode}
System Size: ${systemSize} kW
Payback Period: ${paybackYears.toFixed(1)} years
25-Year ROI: ${(((annualSavings * 25) - systemCost) / systemCost * 100).toFixed(0)}%
Annual Savings: ¬£${annualSavings.toFixed(0)}

Your solar investment will pay for itself in ${Math.ceil(paybackYears)} years.
After that, you'll enjoy free electricity and export income for decades.

================================================================================
                    END OF REPORT - SOLAR ROI CALCULATOR PRO
================================================================================`;
    
    const blob = new Blob([reportContent], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `Solar_Analysis_${postcode.replace(/\s+/g, '_')}_${date.replace(/\//g, '-')}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

// Show Access Denied - GLOBAL SCOPE
function showAccessDenied() {
    document.body.innerHTML = `
        <div style="max-width: 600px; margin: 100px auto; padding: 40px; text-align: center; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
            <h1 style="color: #e74c3c;">üîí Pro Access Required</h1>
            <p style="font-size: 1.2em; margin: 20px 0;">This is the Pro version of our solar calculator.</p>
            <a href="https://buy.stripe.com/28E28r7U0eic7qk2Zge3e00" style="background: #f57c00; color: white; padding: 15px 30px; text-decoration: none; border-radius: 50px; font-size: 1.2em; font-weight: bold; display: inline-block; margin: 20px;">
                Get Pro Access - ¬£4.99 ‚Üí
            </a>
            <p style="margin-top: 20px;">
                <a href="/" style="color: #3498db;">‚Üê Back to Free Calculator</a>
            </p>
        </div>
    `;
}

// Access check - runs AFTER all functions are defined
window.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get('session_id');
    
    // Check for valid access
    if (sessionId && sessionId.startsWith('cs_')) {
        document.getElementById('successMessage').style.display = 'block';
        localStorage.setItem('solarProAccess', 'true');
        localStorage.setItem('proSessionId', sessionId);
        localStorage.setItem('proAccessDate', new Date().toISOString());
        return;
    }
    
    const storedAccess = localStorage.getItem('solarProAccess');
    const storedSession = localStorage.getItem('proSessionId');
    
    if (storedAccess === 'true' && storedSession) {
        document.getElementById('successMessage').innerHTML = '‚úÖ Welcome back to Solar Calculator Pro!';
        document.getElementById('successMessage').style.display = 'block';
        return;
    }
    
    // No access - show denial
    showAccessDenied();
});
</script>

</body>
</html>