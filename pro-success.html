<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Calculator Pro - Advanced UK Solar ROI Analysis</title>
    <meta name="description" content="Professional solar panel ROI calculator with postcode-specific data, battery analysis, and detailed reports.">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: #f8f9fa;
        }
        
        .pro-header {
            background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .pro-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .success-message {
            background: #4caf50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <div class="pro-header">
        <div class="container">
            <div class="pro-badge">PRO VERSION</div>
            <h1>üåü Solar Calculator Pro</h1>
            <p>Advanced analysis with postcode-specific data</p>
        </div>
    </div>

    <div class="container">
        <div class="success-message" id="successMessage">
            ‚úÖ Payment successful! Welcome to Solar Calculator Pro.
        </div>
        
        <div id="mainContent">
            <h2>TEST - If you can see this, security is NOT working!</h2>
            <p>This should be hidden unless you have a valid session_id.</p>
        </div>
    </div>

    <script>
        // Basic protection
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('selectstart', e => {
            if (e.target.tagName !== 'INPUT') e.preventDefault();
        });
        
        // STRICT Security Check
        window.onload = function() {
            console.log('Security check starting...');
            
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id');
            
            console.log('Session ID found:', sessionId);
            
            // Check for valid Stripe session
            if (sessionId && sessionId.startsWith('cs_')) {
                console.log('Valid session detected');
                document.getElementById('successMessage').style.display = 'block';
                localStorage.setItem('solarProAccess', 'true');
                localStorage.setItem('proSessionId', sessionId);
                localStorage.setItem('proAccessDate', new Date().toISOString());
                return; // Allow access
            }
            
            // Check localStorage for previous access
            const storedAccess = localStorage.getItem('solarProAccess');
            const storedSession = localStorage.getItem('proSessionId');
            
            console.log('Stored access:', storedAccess);
            console.log('Stored session:', storedSession);
            
            if (storedAccess && storedSession && storedSession.startsWith('cs_')) {
                console.log('Valid stored session found');
                document.getElementById('successMessage').innerHTML = '‚úÖ Welcome back to Solar Calculator Pro!';
                document.getElementById('successMessage').style.display = 'block';
                return; // Allow access
            }
            
            // No valid access - show denied page
            console.log('No valid access - showing denied page');
            showAccessDenied();
        };
        
        function showAccessDenied() {
            document.body.innerHTML = `
                <div style="max-width: 600px; margin: 100px auto; padding: 40px; text-align: center; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                    <h1 style="color: #e74c3c;">üîí ACCESS DENIED - SECURITY WORKING!</h1>
                    <p style="font-size: 1.2em; margin: 20px 0;">You need to pay for Pro access.</p>
                    
                    <a href="https://buy.stripe.com/28E28r7U0eic7qk2Zge3e00" style="background: #f57c00; color: white; padding: 15px 30px; text-decoration: none; border-radius: 50px; font-size: 1.2em; font-weight: bold; display: inline-block; margin: 20px;">
                        Get Pro Access - ¬£4.99 ‚Üí
                    </a>
                    
                    <p style="margin-top: 20px;">
                        <a href="/" style="color: #3498db;">‚Üê Back to Free Calculator</a>
                    </p>
                </div>
            `;
        }
    </script>
</body>
</html>